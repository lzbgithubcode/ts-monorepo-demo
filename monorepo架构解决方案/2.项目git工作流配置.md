**项目git工作流包括:**
1. 代码规范检测与格式化(js/css/html/vue/react)
2. commit-message规范格式与检测
3. changelog日志生成

#### 一、git工作流的基石`Husky`
我们要设计git 提交代码的工作流，必须清楚的知道githooks，我们在不同的生命周期做一些事情,就需要用到插件 *[husky](https://github.com/typicode/husky)* - git工作流的hooks在提交代码的时候会触发 

*注意: husky只支持本地hooks，不支持服务端hooks*

* 插件[husky](https://github.com/typicode/husky)
* [官方文档](https://typicode.github.io/husky/#/)


##### 1. 安装插件
```
pnpm add husky -wD
```

##### 2. 设置安装之后自动启动hooks
```json
// package.json
{
  "scripts": {
    "prepare": "husky install"
  }
}
```
##### 3. 初始化husky
执行命令后再项目根目录生成`.husky文件夹`,目录下面有`_和husky.sh`
```
  npx husky install
```

##### 4. 创建`pre-commit`hooks执行操作`npm run lint` 
结果：`.husky`目录下创建commit之前执行脚本命令（比如运行代码格式化之类）,会在`.husky`目录创建`pre-commit`的shell文件

```
npx husky add .husky/pre-commit "npm run lint"
```

查看git hooks有多少的方式: 
```
   cd .git/hooks  // 找到git的hooks目录
   ls -a    // 查看所有文件
```

**常用的git-hooks:**
* **commit-msg**: `git commit执行前调用` 常用于校验commit-message的规范
* **pre-commit**: `git commit执行前调用` 常用于代码格式化以及代码规范检查
* **post-commit**: `git commit执行后调用` 不影响commit的结果
* **pre-push**: `git push执行前调用`
* **更多hooks[git-hooks官网](https://git-scm.com/docs/githooks)**


#### 二、代码检测与格式化

##### 1. eslint-代码质量检测以及格式化

1.1 安装eslint 
```
pnpm add eslint -wD
```

1.2 初始化eslint
```
命令一： pnpm create @eslint/config 
命令二： npx eslint --init
命令三： npm init @eslint/config
```

1.3 初始化之后创建文件`.eslintrc.js` - 配置检测ts代码
检测ts代码需要安装配置解析器

```
pnpm add   @typescript-eslint/parser @typescript-eslint/eslint-plugin -wD
```


具体文件配置
```js
// .eslintrc.js
module.exports ={
  //设置格式的更目录
  root: true,
  // 可以支持的环境预定义的全局变量 https://eslint.org/docs/latest/user-guide/configuring/language-options#specifying-environments
  env: {
    "browser": true,
    "es6": true,
    "node": true,
   },
   // 扩展配置-继承 https://eslint.org/docs/latest/user-guide/configuring/configuration-files#extending-configuration-files
   extends: [
      "eslint:recommended",
      "plugin:@typescript-eslint/recommended"
  ],
  // 解析器配置
  parser: "@typescript-eslint/parser",
  // 重写规则配置
  overrides: [
  ],
  // 配置选项 https://eslint.org/docs/latest/user-guide/configuring/language-options#specifying-parser-options
  parserOptions: {
      "ecmaVersion": "latest", // 支持es最新的版本
      "sourceType": "module",  // script / module
      "ecmaFeatures":{  // 附加选项
        "jsx": true, // 支持jsx
         "greater": true, // 使用严格模式
         "globalReturn": true, // 全局支持返回return
      }
  },
  // 使用插件
  plugins: [
    "@typescript-eslint"
  ],
  // 规则配置 https://eslint.org/docs/latest/user-guide/configuring/rules
  rules: {
  }
}
```

1.4 配置代码质量检测与格式化
```json
// package.json 
 "scripts": {
    "lint": "eslint --ext .ts packages/*/src/**.ts",
    "lint:fix": "npm run lint --fix"   // 尽可能多的修复问题 剩下的未修复的问题才会输出
  },
```




#### 四、git工作流的优化`lint-staged`
`lint-staged`是git暂存文件上运行linters的工具
作用: 只校验我们提交( `git add . `)的文件代码格式，而不是去校验所有的文件的格式，可以提高校验效率,避免我们每次检查都把整个项目的代码都检查一遍